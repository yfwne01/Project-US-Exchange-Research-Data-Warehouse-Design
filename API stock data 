import boto3
import json
import os
import datetime
from datetime import date
import sys
import requests
client = boto3.client('s3')

def lambda_handler(event, context):
    # TODO implement
    bucket_name = 'dbprojectstockdata'
    #tickrs = ['MSFT', 'SAP', 'WIT', 'LPL', 'NVS', 'GSK', 'TAK', 'NVO', 'JPM', 'BMA', 'WBK', 'BSAC', 'XOM', 'BTE', 'SNP', 'SSL']
    tickrs = ['BMA', 'LPL', 'GSK', 'SNP']
    api_key = 'ROQQ578DPMS8A3T8'

    for tickr in tickrs:
        key_name = "stock_status_" + tickr + "_" + str(date.today()) + ".txt"
        url = "https://www.alphavantage.co/query?function=TIME_SERIES_DAILY_ADJUSTED&outputsize=FULL&symbol=" + tickr + "&apikey=" + api_key + "&datatype=csv"
        r = requests.get(url)
        data = r.text

    	# Export the data to S3
        response = client.put_object(Bucket=bucket_name,
					             Body=data,
					             Key=key_name)
